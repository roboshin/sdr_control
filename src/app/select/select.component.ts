import {Component, OnInit} from '@angular/core';
import {FileService, ViewLayerService} from "../file.service";


@Component({
  selector: 'app-select',
  templateUrl: './select.component.html',
  styleUrls: ['./select.component.scss']
})
export class SelectComponent implements OnInit {
  /**
   * itemsRobot : ロボット名称
   * itemsKui   :　杭ナビ番号
   * itemViewLayer :　表示用レイヤー名称
   * itemDrawLayer :　描画用レイヤー名称
   */
  public itemsRobot: string[] = ['SDR2-1', 'SDR2-2',];
  public itemsKui: string[] = ['KUI1',];
  public itemViewLayer: string[] = ['A'];
  public itemDrawLayer: string[] = ['DrawLayer01'];

  shortLink: string = "";
  loading: boolean = false;
  file: File = null;

  constructor(private fileUploadService: FileService, private viewLayerService: ViewLayerService) {
  }

  ngOnInit(): void {
  }

  /**
   * 選択ファイルを確定
   * @param event
   */
  onChange(event) {
    this.file = event.target.files[0];
  }

  /**
   * ファイルアップロード用
   * ロボット側で、ファイルアップロード後にファイルパースの結果を受け取る
   * サーバーからの戻り値　DXFに含まれるレイヤー名の一覧
   * 画面表示用に、　各カーブのポイント配列、レイヤー名
   * 交点タップ用に　各カーブ同士の交点一覧
   */
  onUpload() {
    this.loading = !this.loading;
    console.log(this.file);
    this.fileUploadService.upload(this.file).subscribe((event: any) => {
      if (typeof (event) == 'object') {
        this.shortLink = event.link;
        this.loading = false;
      }
    });
  }


  onLoadViewLayer() {
    this.viewLayerService.getViewLayer()
      .subscribe(viewLayers => this.itemViewLayer = viewLayers);
  }


}
